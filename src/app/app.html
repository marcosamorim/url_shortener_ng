<div class="page">
  <header class="header">
    <div class="logo">rdrt</div>
    <h1 class="title">URL Shortener</h1>
    <p class="subtitle">
      Paste a long URL, get a short one.
    </p>
  </header>

  <main class="card">
    <form class="form" (submit)="onSubmit()">
      <label for="url" class="label">Long URL</label>

      <div class="input-row">
        <input
          id="url"
          name="url"
          type="url"
          [(ngModel)]="url"
          placeholder="https://example.com/very/long/link"
          class="input"
          [class.input-error]="error()"
          autocomplete="off"
        />

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isLoading() || !url"
        >
          @if (!isLoading()) {
            Shorten
          } @else {
            <span class="spinner"></span>
          }
        </button>
      </div>

      @if (error()) {
        <p class="error">
          {{ error() }}
        </p>
      }
    </form>

    @if (result()) {
      <section class="result">
        <h2 class="result-title">Short URL</h2>

        <div class="result-main">
          <div class="result-text">
            <div class="result-row">
              <a
                class="short-url"
                [href]="result()!.short_url"
                target="_blank"
                rel="noopener noreferrer"
              >
                {{ result()!.short_url }}
              </a>

              <button
                type="button"
                class="btn btn-secondary"
                (click)="copyShortUrl()"
              >
                Copy
              </button>

              <button
                type="button"
                class="btn btn-secondary"
                (click)="toggleQr()"
              >
                @if (showQr()) {
                  Hide QR
                } @else {
                  Show QR
                }
              </button>
            </div>

            <div class="meta">
              <div>
                <div class="meta-label">Original</div>
                <div class="meta-value original-url">
                  {{ result()!.original_url }}
                </div>
              </div>
            </div>
          </div>

          @if (showQr()) {
            <div class="qr-card">
              <div class="qr-url">
                {{ shortUrlLabel }}
              </div>

              <div class="qr-code-wrapper">
                <qrcode
                  [qrdata]="result()!.short_url"
                  [width]="220"
                  [errorCorrectionLevel]="'H'"
                ></qrcode>

                <div class="qr-logo">
                  <div class="qr-logo-inner">rdrt</div>
                </div>
              </div>
            </div>
          }
        </div>
      </section>
    }
  </main>

  <footer class="footer">
    Frontend: Angular Â· API: FastAPI
  </footer>

  @if (toastMessage()) {
    <div class="toast">
      {{ toastMessage() }}
    </div>
  }
</div>
