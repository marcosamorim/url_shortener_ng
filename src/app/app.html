<div class="page">
  <header class="header">
    <div class="logo">rdrt</div>
    <h1 class="title">URL Shortener</h1>
    <p class="subtitle">Paste a long URL, get a short one.</p>
  </header>

  <main class="card">
    <!-- OPTIONAL LOGIN -->
    <section class="auth">
      <div class="auth-head">
        <div class="auth-title">Sign in (optional)</div>

        @if (isLoggedIn()) {
          <div class="auth-status auth-status-on">Signed in</div>
        } @else {
          <div class="auth-status auth-status-off">Not signed in</div>
        }
      </div>

      <p class="auth-hint">
        If you sign in, your links can be tied to your user for private stats later. Otherwise, you can still shorten URLs normally.
      </p>

      @if (!isLoggedIn()) {
        <form class="auth-form" (submit)="login()">
          <div class="auth-row">
            <div class="auth-field">
              <label class="label" for="email">Email</label>
              <input
                id="email"
                name="email"
                type="email"
                [(ngModel)]="email"
                class="input"
                autocomplete="email"
                placeholder="you@example.com"
              />
            </div>

            <div class="auth-field">
              <label class="label" for="password">Password</label>
              <input
                id="password"
                name="password"
                type="password"
                [(ngModel)]="password"
                class="input"
                autocomplete="current-password"
                placeholder="••••••••"
              />
            </div>

            <button
              type="submit"
              class="btn btn-secondary"
              [disabled]="isLoading() || !email.trim() || !password"
            >
              @if (!isLoading()) {
                Sign in
              } @else {
                <span class="spinner"></span>
              }
            </button>
          </div>
        </form>
      } @else {
        <div class="auth-actions">
          <button type="button" class="btn btn-secondary" (click)="logout()">
            Sign out
          </button>
        </div>
      }
    </section>

    <hr class="divider" />

    <!-- SHORTEN FORM (ALWAYS AVAILABLE) -->
    <form class="form" (ngSubmit)="onSubmit()">
      <label for="url" class="label">Long URL</label>

      <div class="input-row">
        <input
          id="url"
          name="url"
          type="url"
          [(ngModel)]="url"
          placeholder="https://example.com/very/long/link"
          class="input"
          [class.input-error]="error()"
          autocomplete="off"
        />

        <button type="submit" class="btn btn-primary" [disabled]="isLoading() || !url">
          @if (!isLoading()) {
            Shorten
          } @else {
            <span class="spinner"></span>
          }
        </button>
      </div>

      @if (error()) {
        <p class="error">{{ error() }}</p>
      }
    </form>

    @if (result()) {
      <section class="result">
        <h2 class="result-title">Short URL</h2>

        <div class="result-main">
          <div class="result-text">
            <div class="result-row">
              <a
                class="short-url"
                [href]="result()!.short_url"
                target="_blank"
                rel="noopener noreferrer"
              >
                {{ result()!.short_url }}
              </a>

              <button type="button" class="btn btn-secondary" (click)="copyShortUrl()">
                Copy
              </button>

              <button type="button" class="btn btn-secondary" (click)="toggleQr()">
                @if (showQr()) { Hide QR } @else { Show QR }
              </button>
            </div>

            <div class="meta">
              <div>
                <div class="meta-label">Original</div>
                <div class="meta-value original-url">{{ result()!.original_url }}</div>
              </div>
            </div>
          </div>

          @if (showQr()) {
            <div class="qr-container">
              <div class="qr-card" #qrCard>
                <div class="qr-url">{{ shortUrlLabel }}</div>

                <div class="qr-code-wrapper">
                  <qrcode
                    [qrdata]="result()!.short_url"
                    [width]="220"
                    [errorCorrectionLevel]="'H'"
                  ></qrcode>

                  <div class="qr-logo">
                    <div class="qr-logo-inner">rdrt</div>
                  </div>
                </div>
              </div>

              <div class="qr-actions">
                <button
                  type="button"
                  class="btn btn-secondary qr-action-btn"
                  (click)="downloadQrCard()"
                >
                  Download card
                </button>

                <button
                  type="button"
                  class="btn btn-secondary qr-action-btn"
                  (click)="copyQrCardToClipboard()"
                >
                  Copy card
                </button>
              </div>
            </div>
          }
        </div>
      </section>
    }
  </main>

  <footer class="footer">Frontend: Angular · API: FastAPI</footer>

  @if (toastMessage()) {
    <div class="toast">{{ toastMessage() }}</div>
  }
</div>
